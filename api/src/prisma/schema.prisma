enum AppointmentStatus {
  pending
  confirmed
  cancelled
  completed
}

model AvailabilitySlot {
  id        String   @id @default(uuid())
  doctorId  String
  startTime DateTime
  endTime   DateTime

  // Booking link (null = free, not null = booked)
  bookedAppointmentId String? @unique
  bookedAppointment   Appointment? @relation(fields: [bookedAppointmentId], references: [id], onDelete: SetNull)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  doctor User @relation(fields: [doctorId], references: [id], onDelete: Cascade)

  @@index([doctorId, startTime])
  @@unique([doctorId, startTime, endTime])
}

model Appointment {
  id        String            @id @default(uuid())
  doctorId  String
  patientId String

  startTime DateTime
  endTime   DateTime

  status    AppointmentStatus @default(pending)
  reason    String?
  notes     String?

  // link to slot
  slotId String? @unique
  slot   AvailabilitySlot? @relation(fields: [slotId], references: [id], onDelete: SetNull)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  doctor  User @relation("DoctorAppointments", fields: [doctorId], references: [id], onDelete: Cascade)
  patient User @relation("PatientAppointments", fields: [patientId], references: [id], onDelete: Cascade)

  @@index([doctorId, startTime])
  @@index([patientId, startTime])
}
